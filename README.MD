Техническое задание

Описать в общих словах что реализует код в файле ExpireContentPlanHandler.php. Найти места потенциальных ошибок, и предложить решения для улучшения качества кода. Все ваши комментарии и решения внести в файл кода.



Описание файлов 

```
ExpireContentPlanHandler.php -  изначальный файл который прилагался по тз 

**следующие файлы подписанны не под какой из конвенций пхп так как являются просто тестовыми и их можно написать на колленке**

working_file.php -  файл который содержит изначальный код коментарии и правки 
final_file.php - файл с перепроектированным кодом скажем так что б глаз мог его хотя бы прочитать 
```
Описание 
ExpireContentPlanHandler.php 
является классом спроектированным по патерну екзекутер  (который будет срабатывать при инцилизации нового класса и спомощью волшебного метода  __invoke() )

сам класс выполняет логику проверки на истёкшую подписку на контент план в котором случается следующая логика при нахождении следующих состояний обьекта contentPlan на который подписываются пользователи(клиенты)


при первом запросе у юзера getSubscriptionUpdateStatus 
если статус in_progress этом  то мы либо заканчиваем логику екзекута или выдаём ексепшн как автор имелл ввиду не знаю
если статус отличается то устанавливаем  статус   in_progress и сохраняем в бд

следующим шагом мы вызываем следующий контент план в котором проверяем не является ли у него статус 'progress', 'done'
если да то устанавливаем юзеру у кого этот план находится статус ready 
**ремарка я немного позапутался в getuser где то возможно поймаю  проблему что я повторился кодом с получением какого то обьекта вместо вызова его из памяти код не тестировал так что сказать не смогу насколько точно и где ошибся**

если таким статусом не является а статус ```paid```
копируются все настройки для следующего контент плана 
если же нет 

то проверяем юзера есть ли у него подписка  если булевый ответ получаем true он же 1 
получаем план и ставим статус ```ready```
и возвращаем пустоту 

если нету подписки пытаемся проверить payments у пользователя  и создать намеринье   создать новый платёж 

в проектировании кода так и скорее всего намереньях к базе данных было спроектированно по коду что переменная amount в прайсе храниться в  типе float или double  что является антипатерном при разработки денежных систем так как всегда нужно учитывать в плоть до копейки а значи польшей части хранить будет лучше в каком нибудь цело численном значениии которое потом можно будет разделить и получить тот же самый float или double 

ну и при создании нового платежа мы создаём новый контентплан для юзера 
и обновляем текуший план у нашего юзера на ```ready```
